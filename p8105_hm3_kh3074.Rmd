---
title: "p8105_hw3_kh3074"
output: github_document
date: 10-14-2021
author: KaiYu He(kh3074)
---
```{r}
library(tidyverse)
library(p8105.datasets)
```
## Plot seetings
```{r}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

## Load Data
```{r}
data("instacart")
summary(instacart)
```
### interpretation of the data  
- The ***instacart*** data has `r nrow(instacart)` rows of data with `r ncol(instacart)` columns of features.
- The is an online grocery shopping data set, ***order_id*** is the identifier for each order, ***prodect_id*** is the product identifier, ***reordered*** equals 1 if the product is ordered by the user in the past, ***order_dow*** is the day of the week on which the product was placed, ***days_since_prior_order*** is days since the last order, capped at 30, NA if order_number=1.  
- Take the first line as an example, Bulgarian Yogurt was placed by user '112108' from 'dairy eggs' department. This is not the first time the user buys this item.  

### 1
```{r}
instacart%>%
  count(aisle)%>% 
  arrange(desc(n))%>%
  head()%>%
  knitr::kable() #show the most 5 items ordered
```

- There are `r instacart%>%count(aisle)%>%nrow()` aisles in the data, accroding the data frame, fresh vegetable is the most ordered item.  


### 2

```{r}
instacart%>%
  count(aisle)%>%
  filter(n>10000)%>%
  mutate(aisle = fct_reorder(aisle,n))%>%
  ggplot(aes(x = n,y = aisle))+
  geom_point()

```

### 3  
```{r}
instacart%>%
  filter( aisle == 'baking ingredients'|aisle == 'dog food care'|aisle == 'packaged vegetables fruits')%>%
  group_by(aisle,product_name)%>%
  summarize(
    n_obs = n()
  )%>%
  top_n(3)%>%
  knitr::kable()
```

### 4
```{r}
instacart%>%
  filter(product_name == 'Pink Lady Apples'|product_name == 'Coffee Ice Cream')%>%
  group_by(order_dow,product_name)%>%
  summarize(
    mean_hour_of_day = mean(order_hour_of_day)
  )%>%
  pivot_wider(
    names_from = product_name,
    values_from = mean_hour_of_day
  )%>%
  knitr::kable()
```

# Problem 2  

## Load data  
```{r}
data("brfss_smart2010")

brfss_smart2010%>%
  janitor::clean_names()%>% #format the data to use appropriate variable names;
  filter(topic == 'Overall Health') #focus on the “Overall Health” topic
  
```

## Data Cleaning  

```{r}
brfss_smart2010 = 
  brfss_smart2010%>%
  janitor::clean_names()%>% #format the data to use appropriate variable names;
  filter(topic == 'Overall Health')%>% #focus on the “Overall Health” topic
  filter(response == 'Excellent'|response == 'Very good'|response == 'Good'|response == 'Fair'|response == 'Poor')%>%
  #include only responses from “Excellent” to “Poor”
  mutate(rank = response)%>%
  mutate(rank = recode(rank,'Excellent' = 5,'Very good' = 4,'Good' = 3,'Fair' = 2, 'Poor' = 1))%>%
  mutate(response = as.factor(response))%>%
  mutate(response = fct_reorder(response,rank))%>% #organize responses as a factor taking levels ordered from “Poor” to “Excellent”
  select(-rank)
```

## 1  
```{r}
state_2002 = 
  brfss_smart2010%>%
  filter(year == 2002)%>%
  group_by(locationabbr)%>%
  rename('state_2002' = locationabbr)%>%
  summarize(locations_obversed = n()/5)%>% #Five levels for each location
  filter(locations_obversed >= 7)
```

- According to the table, there are `r nrow(state_2002)` states were observed at more than 7 locations.
  
```{r}
state_2010 = 
  brfss_smart2010%>%
  filter(year == 2010)%>%
  group_by(locationabbr)%>%
  rename('state_2010' = locationabbr)%>%
  summarize(locations_obversed = n()/5)%>% #Five levels for each location
  filter(locations_obversed >= 7)
```

- According to the table, there are `r nrow(state_2010)` states were observed at more than 7 locations.

# 2
